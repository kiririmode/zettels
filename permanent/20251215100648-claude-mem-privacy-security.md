---
id: 2025-12-15-100648
title: Claude-Memのプライバシーとセキュリティ考慮事項
created: 2025-12-15 10:06:48
updated: 2025-12-15 10:06:48
tags:
  - zettel
  - ai
  - claude
  - security
  - privacy
  - risk-management
  - agpl
source:
  type: article
  ref: "Claude-Mem（claude-mem）の仕組みと導入判断"
---

## 要約（Summary）

- Claude-Memは`<private>`タグで機密情報を保存前に除去するエッジ処理を提供するが、タグ付け忘れのリスクがある
- ローカルHTTPサーバ（37777）を誤設定（0.0.0.0バインド）するとLANに露出し、機密情報漏洩の危険
- AGPL-3.0ライセンスは改変配布時の開示義務が重く、企業利用では事前審査が必須

## 本文（Body）

### 背景・問題意識

コーディングエージェントが扱うデータには、APIキー、データベース接続文字列、個人情報、企業機密などが含まれる。これらが意図せず記録・漏洩すれば、重大なセキュリティインシデントに繋がる。

Claude-Memは**ローカルに永続化**し、**HTTPサーバを起動**し、**ユーザ入力を記録**するため、プライバシーとセキュリティの考慮が不可欠である。特に企業利用では、以下を事前に検証する必要がある：

1. 機密情報の記録範囲と除外メカニズム
2. ネットワーク露出リスク
3. ライセンス適合性
4. データの保存場所とアクセス制御

### アイデア・主張

**Claude-Memは設計上プライバシー保護機能（`<private>`タグ）を持つが、実運用では「タグ付け忘れ」「ネットワーク誤設定」「AGPL開示義務」などの実務リスクが存在するため、企業導入時には運用ルール・技術的ガードレール・ライセンス審査の3点セットで対策する必要がある。**

#### 良い点（設計として明示されている保護機能）

**1. `<private>`タグによるエッジフィルタリング**
- 保存したくない情報を`<private>...</private>`で囲む
- フック層（保存前）でタグ内容を除去
- DBや検索インデックスに到達させない設計

```
ユーザ入力: 
「APIキーは <private>sk-1234abcd</private> を使ってください」
→ DB保存時: 「APIキーは  を使ってください」
```

**2. ローカル完結の設計**
- データは`~/.claude-mem/`に保存
- クラウド送信なし（設計上）

#### 注意点（実運用で事故りやすいポイント）

**1. タグ付け忘れのリスク**

問題：
- ユーザが`<private>`タグを付け忘れると、機密情報がそのまま記録される
- 「後で気づいて削除」はDBに残っている可能性

対策：
- **機密情報検出ツールとの組み合わせ**（git-secretsやtruffleHog的なもの）
- **定期的なDB監査**（grep等で機密パターンをスキャン）
- **教育とガイドライン**（何を`<private>`にすべきか明文化）

**2. HTTPサーバのネットワーク露出**

問題：
- デフォルトは`localhost:37777`だが、設定で`0.0.0.0:37777`にバインド可能
- 誤設定するとLAN内の他端末からアクセス可能
- 社内Wi-Fi環境では特に危険

対策：
- **バインドアドレスを明示的に`127.0.0.1`に固定**
- **ファイアウォールで37777をブロック**（外部接続不可に）
- **MDM（Mobile Device Management）で設定を強制**

**3. user_promptsの全記録**

問題：
- `<private>`タグを使わない限り、ユーザ入力がそのまま`user_prompts`テーブルに保存
- 過去の入力を全文検索できてしまう

対策：
- **入力時の注意喚起UI**（「この入力は記録されます」警告）
- **定期的なクリーンアップ**（古いプロンプトを自動削除）
- **暗号化**（端末の全体暗号化、DB暗号化）

**4. AGPL-3.0ライセンスの開示義務**

問題：
- AGPLはネットワーク越しにサービス提供する場合も開示義務あり
- 改変して社内配布・サービス化する場合、ソースコード開示が必要
- 企業によってはAGPLを採用禁止にしている

対策：
- **法務・OSS担当との事前協議**
- **改変しない前提での利用**（プラグインとして利用のみ）
- **代替ツールの検討**（MIT/Apache 2.0ライセンスのもの）

**5. データの保存場所とバックアップ**

問題：
- `~/.claude-mem/`がバックアップされると、機密情報が外部ストレージに残る
- クラウドバックアップ（iCloud、Dropbox等）に自動同期される可能性

対策：
- **バックアップ対象から除外**（.gitignore的な設定）
- **端末全体の暗号化**（FileVault、BitLocker等）
- **退職時の完全削除手順**（端末返却前のクリーンアップ）

### 内容を視覚化するMermaid図

```mermaid
graph TB
    subgraph "リスクポイントと対策"
        A["ユーザ入力"] --> B{"`<private>`タグ<br/>付けた？"}
        B -->|Yes| C["エッジフィルタで除去<br/>✅ 安全"]
        B -->|No| D["そのままDB保存<br/>⚠️ 漏洩リスク"]
        
        E["HTTPサーバ起動<br/>(37777)"] --> F{バインドアドレス}
        F -->|127.0.0.1| G["ローカルのみ<br/>✅ 安全"]
        F -->|0.0.0.0| H["LAN公開<br/>⚠️ 露出リスク"]
        
        I["ライセンス<br/>(AGPL-3.0)"] --> J{改変配布する？}
        J -->|No| K["プラグイン利用のみ<br/>✅ OK"]
        J -->|Yes| L["ソース開示義務<br/>⚠️ 法務確認必要"]
        
        M["データ保存<br/>(~/.claude-mem/)"] --> N{バックアップ設定}
        N -->|除外設定| O["外部流出防止<br/>✅ 安全"]
        N -->|自動同期| P["クラウド流出<br/>⚠️ 漏洩リスク"]
    end
    
    subgraph "推奨対策"
        Q["1. 機密検出ツール連携"]
        R["2. バインドアドレス固定"]
        S["3. DB定期監査"]
        T["4. 法務事前協議"]
        U["5. バックアップ除外設定"]
    end
    
    D -.対策.- Q
    D -.対策.- S
    H -.対策.- R
    L -.対策.- T
    P -.対策.- U
    
    style C fill:#d4f1d4
    style G fill:#d4f1d4
    style K fill:#d4f1d4
    style O fill:#d4f1d4
    style D fill:#ffcccc
    style H fill:#ffcccc
    style L fill:#fff4cc
    style P fill:#ffcccc
```

### 具体例・ケース

**ケース1: APIキー漏洩インシデント（タグ付け忘れ）**
```
状況: 開発者が「OpenAI APIキー: sk-xxxxx を使って」と入力
問題: <private>タグを付け忘れ
結果: user_promptsテーブルに平文保存
対策: 定期的なDB監査で"sk-"パターンを検出し、手動削除＋警告
```

**ケース2: LAN内アクセス（誤設定）**
```
状況: 設定ファイルでbind="0.0.0.0"に変更（リモート接続を試したかった）
問題: 社内Wi-Fi経由で他の端末から http://192.168.1.100:37777 にアクセス可能
結果: 同僚が誤って記憶データを閲覧
対策: FWで37777をブロック＋設定レビュー自動化
```

**ケース3: 退職時のデータ残留**
```
状況: 開発者退職、端末返却
問題: ~/.claude-mem/ にプロジェクト機密が残っている
結果: 次の利用者が過去データを閲覧可能
対策: 退職時チェックリストに「Claude-Mem DB削除」を追加
```

**ケース4: AGPL違反リスク（改変配布）**
```
状況: 社内用にClaude-Memを改造し、内製ツールとして配布
問題: AGPLの開示義務を理解せず
結果: OSS違反のリスク
対策: 法務に改変配布計画を事前相談、代替案（MIT/Apache 2.0ツール）を検討
```

### 反論・限界・条件

**「ローカル完結だから安全」は誤り**
- 端末自体が盗難・紛失されれば終わり
- 端末の暗号化が前提条件

**`<private>`タグは完全ではない**
- タグ付け忘れを防ぐ仕組みがない
- 自動検出（機械学習等）も完全ではない

**HTTPサーバの必要性**
- Web UIが不要なら、HTTPサーバを無効化する選択肢もあるはず
- 設定で無効化できるかは要確認

**AGPL回避策の限界**
- プラグインとして利用のみなら大丈夫、という理解だが、解釈が分かれる可能性
- 企業によってはAGPL一律禁止

## 関連ノート（Links）

- [[20251215100646-claude-mem-overview|Claude-Memの概要と継続記憶機能]] - 全体像
- [[20251215100647-claude-mem-architecture|Claude-Memのアーキテクチャとデータフロー]] - 技術的仕組み
- [[20251129160319-ai-guardrails|AI開発におけるガードレールの重要性]] - ガードレールの一般論
- [[20251215095358-tag-enforcement-governance|作成時タグ強制によるガバナンス戦略]] - タグを使ったガバナンス
- [[20251215004321-ai-output-quality-check-responsibility|AI生成コンテンツの品質チェック責任]] - 責任の所在

## To-Do / 次に考えること

- [ ] 機密情報検出ツール（truffleHog等）とClaude-Memの連携方法を調査
- [ ] HTTPサーバ無効化オプションの有無を確認
- [ ] 社内ガイドライン作成（`<private>`タグの使用ルール）
- [ ] 法務にAGPLライセンス適合性を確認
- [ ] 退職時チェックリストに「Claude-Mem DB削除」を追加
- [ ] バックアップ設定のデフォルト除外リストに`~/.claude-mem/`を追加
